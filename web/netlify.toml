[build]
  base    = "web"
  # Executa o build unificado na raiz, garante dependências instaladas e expõe node_modules via symlink.
  command = "npm --prefix .. install && npm --prefix .. run build && ln -sfn ../node_modules node_modules"
  # publish é relativo ao base
  publish = ".next"

[build.environment]
  # Fala com a API do site da raiz (root)
  NEXT_PUBLIC_API_BASE   = "https://lifeflourishconsulting.netlify.app"
  # Modo TOKEN (sem cookies cross-site). O front salva/envia Authorization: Bearer.
  NEXT_PUBLIC_COOKIE_MODE = "0"
  COOKIE_MODE             = "0"

[[plugins]]
  package = "@netlify/plugin-nextjs"
